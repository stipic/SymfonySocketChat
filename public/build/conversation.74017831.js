(window.webpackJsonp=window.webpackJsonp||[]).push([["conversation"],{k6dk:function(n,e,t){(function(n){t("ng4s");var e=window.location.hostname,o=WS.connect("ws://"+e+":5510");o.on("socket/connect",function(e){function t(n){n.scrollTop=n.scrollHeight}t(document.getElementById("content"));var o={appendMessage:function(e){n("#org-msg-zone").append(e),t(document.getElementById("content"))},appendMessageChunk:function(e){console.log("CHUNK #1"),n("#org-msg-zone .message:last").find(".text").append(e),t(document.getElementById("content"))}};function i(i){e.subscribe(i,function(n,e){"msg_block"==e.msg.msgType?o.appendMessage(e.msg.template):o.appendMessageChunk(e.msg.template)}),e.subscribe(i+"/notifications",function(e,o){console.log(o);var i=JSON.parse(o),s='\n            <div class="message" data-writing="'+clientInformation.username+'">\n                <img class="avatar-md" src="/avatar.jpg" data-toggle="tooltip" data-placement="top" title="" alt="avatar" data-original-title="Keith">\n                <div class="text-main">\n                    <div class="text-group">\n                        <div class="text typing">\n                            <div class="wave">\n                                <span class="dot"></span>\n                                <span class="dot"></span>\n                                <span class="dot"></span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>';for(var a in n('[data-writing="'+clientInformation.username+'"]').remove(),i)i.hasOwnProperty(a)&&!n('[data-writing="'+clientInformation.username+'"]').length&&clientInformation.username!=a&&(n("#writing-notif-zone").append(s),t(document.getElementById("content")))})}n(document).on("click","#submit-message",function(t){t.preventDefault();var o=n("#form-message").val();o&&n.ajax({url:"/message/"+clientInformation.conversationId+"/new",type:"POST",data:{message:o},complete:function(n){}}),n("#form-message").val("").change(),n("#form-message").html(""),clientInformation.isWriting=!1,e.publish(clientInformation.wsConversationRoute+"/notifications",clientInformation.isWriting)}),document.getElementById("form-message").focus(),n(document).on("keypress","#form-message",function(e){13===e.keyCode&&(e.preventDefault(),n("#submit-message").trigger("click"),n("#form-message").val(""))}),n(document).on("input","#form-message",function(t){t.preventDefault();var o=n("#form-message").val();o.length>0&&0==clientInformation.isWriting?(clientInformation.isWriting=!0,e.publish(clientInformation.wsConversationRoute+"/notifications",clientInformation.isWriting)):0==o.length&&1==clientInformation.isWriting&&(clientInformation.isWriting=!1,e.publish(clientInformation.wsConversationRoute+"/notifications",clientInformation.isWriting))}),i(clientInformation.wsConversationRoute),n(document).on("click",".discussions li",function(o){o.preventDefault(),n(".discussions li").removeClass("active"),n(this).addClass("active");var s=n(this).attr("data-cid"),a={foo:"bar"};n.ajax({url:"/message/"+s+"/section",type:"GET",success:function(o){n("#msg-section").remove(),n(o).insertAfter("#sidebar"),t(document.getElementById("content")),window.history.pushState(a,"Conversation","/conversation/"+s),e.unsubscribe(clientInformation.wsConversationRoute),e.unsubscribe(clientInformation.wsConversationRoute+"/notifications"),clientInformation.wsConversationRoute="conversation/"+s,clientInformation.conversationId=s,i(clientInformation.wsConversationRoute)}})}),e.subscribe("online",function(e,t){var o=JSON.parse(t);n("li[data-usid]").each(function(e){var t=n(this).attr("data-usid");for(var i in n('li[data-usid="'+t+'"]').find(".user-details").removeClass("online"),o)o.hasOwnProperty(i)&&i==t&&n('li[data-usid="'+t+'"]').find(".user-details").addClass("online")})}),e.subscribe("unreaded/"+clientInformation.username,function(e,t){console.log("unreaded: ",t);var o=JSON.parse(t);for(var i in o)o.hasOwnProperty(i)&&o[i]>0&&n("li[data-cid='"+i+"'] .user-nickname span:last").html(o[i])}),console.log("Successfully Connected!")}),o.on("socket/disconnect",function(n){console.log("Disconnected for "+n.reason+" with code "+n.code),location.reload()})}).call(this,t("EVdn"))}},[["k6dk","runtime",1,0]]]);